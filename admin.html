<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - Kya Hai Mahaul</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <style>
    body { background: #000; color: #fff; font-family: Arial; padding: 20px; }
    h2 { text-align: center; }
    input, textarea {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #e50914;
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    label { font-weight: bold; display: block; margin-top: 15px; }
    #navList {
      list-style: none;
      padding: 0;
    }
    #navList li {
      background: #111;
      padding: 10px;
      margin-bottom: 5px;
      cursor: grab;
      border-radius: 5px;
    }
    #thumbPreview {
      width: 100%;
      margin-top: 10px;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <h2>üõ†Ô∏è Admin Panel - Kya Hai Mahaul</h2>

  <label>Upload Home Thumbnail Image:</label>
  <input type="file" id="thumbUpload" accept="image/*" />
  <img id="thumbPreview" src="" alt="Preview" />

  <label>Home News Text:</label>
  <textarea id="homeNews" placeholder="Write homepage news here..."></textarea>

  <label>Video Links (comma separated):</label>
  <textarea id="videoInput" placeholder="https://youtu.be/abc123, https://youtu.be/xyz456"></textarea>

  <label>Short Video Link:</label>
  <input id="shortInput" placeholder="https://youtu.be/short123" />

  <label>News Line 1:</label>
  <textarea id="desc1"></textarea>
  <label>News Line 2:</label>
  <textarea id="desc2"></textarea>
  <label>News Line 3:</label>
  <textarea id="desc3"></textarea>

  <label>üîÉ Reorder Navigation Buttons:</label>
  <ul id="navList">
    <li draggable="true">Home</li>
    <li draggable="true">Video</li>
    <li draggable="true">Short</li>
    <li draggable="true">Description</li>
    <li draggable="true">Share</li>
  </ul>

  <button onclick="saveData()">‚úÖ Save to Firebase</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBISasRnfZD0Y0UgAZDoTJ2SV2TwvzlDrM",
      authDomain: "kyahaimahaul-e4551.firebaseapp.com",
      databaseURL: "https://kyahaimahaul-e4551-default-rtdb.firebaseio.com",
      projectId: "kyahaimahaul-e4551",
      storageBucket: "kyahaimahaul-e4551.appspot.com",
      messagingSenderId: "69916634629",
      appId: "1:69916634629:web:60cf5433aaed97bf12766c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref("mahaulApp");
    const storage = firebase.storage().ref("thumbnails");

    let uploadedThumbURL = "";

    document.getElementById("thumbUpload").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const uploadTask = storage.child(Date.now() + "-" + file.name).put(file);
      uploadTask.on("state_changed", null, console.error, () => {
        uploadTask.snapshot.ref.getDownloadURL().then(url => {
          uploadedThumbURL = url;
          document.getElementById("thumbPreview").src = url;
          document.getElementById("thumbPreview").style.display = "block";
        });
      });
    });

    // Drag-and-drop logic
    let dragged;
    const navList = document.getElementById("navList");
    navList.addEventListener("dragstart", (e) => {
      dragged = e.target;
    });
    navList.addEventListener("dragover", (e) => {
      e.preventDefault();
      const target = e.target.closest("li");
      if (target && target !== dragged) {
        const rect = target.getBoundingClientRect();
        const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
        navList.insertBefore(dragged, next && target.nextSibling || target);
      }
    });

    function extractID(url) {
      const match = url.match(/(?:youtu\.be\/|v=)([^&\s]+)/);
      return match ? match[1] : "";
    }

    function extractAllIDs(text) {
      return text.split(",").map(link => extractID(link.trim())).filter(id => id);
    }

    function saveData() {
      const navOrder = Array.from(document.querySelectorAll("#navList li")).map(li => li.innerText);
      const data = {
        thumb: uploadedThumbURL,
        homeNews: document.getElementById("homeNews").value,
        video: extractAllIDs(document.getElementById("videoInput").value).join(","),
        short: extractID(document.getElementById("shortInput").value),
        desc1: document.getElementById("desc1").value,
        desc2: document.getElementById("desc2").value,
        desc3: document.getElementById("desc3").value,
        navOrder: navOrder
      };
      db.set(data).then(() => alert("‚úÖ Saved Successfully!"));
    }
  </script>
</body>
</html>
